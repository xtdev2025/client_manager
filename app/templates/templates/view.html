{% extends "layout.html" %}

{% block title %}Detalhes do Modelo - Gerenciador de Clientes{% endblock %}

{% block page_title %}Detalhes do modelo{% endblock %}

{% block content %}
<div class="card shadow">
    <div class="card-header bg-info text-white d-flex flex-wrap justify-content-between align-items-center gap-2">
        <h5 class="mb-0"><i class="fas fa-file-code me-2"></i>{{ template.name }}</h5>
        <div class="d-flex gap-2">
            <a href="{{ url_for('template.edit_template', template_id=template._id) }}" class="btn btn-warning">
                <i class="fas fa-edit me-2"></i>Editar
            </a>
            <a href="{{ url_for('template.list_templates') }}" class="btn btn-outline-light">
                <i class="fas fa-arrow-left me-2"></i>Voltar
            </a>
        </div>
    </div>
    <div class="card-body">
        <div class="row g-4">
            <div class="col-md-6">
                <dl class="row mb-0">
                    <dt class="col-sm-4 text-muted">Nome</dt>
                    <dd class="col-sm-8 fw-semibold">{{ template.name }}</dd>

                    <dt class="col-sm-4 text-muted">Status</dt>
                    <dd class="col-sm-8">
                        {% if template.status == 'active' %}
                        <span class="badge bg-success">Ativo</span>
                        {% else %}
                        <span class="badge bg-secondary">Inativo</span>
                        {% endif %}
                    </dd>

                    <dt class="col-sm-4 text-muted">ID</dt>
                    <dd class="col-sm-8"><code>{{ template._id }}</code></dd>
                </dl>
            </div>
            <div class="col-md-6">
                <dl class="row mb-0">
                    <dt class="col-sm-5 text-muted">Criado em</dt>
                    <dd class="col-sm-7">{{ template.createdAt.strftime('%d/%m/%Y %H:%M') if template.createdAt else 'N/D' }}</dd>

                    <dt class="col-sm-5 text-muted">Atualizado em</dt>
                    <dd class="col-sm-7">{{ template.updatedAt.strftime('%d/%m/%Y %H:%M') if template.updatedAt else 'N/D' }}</dd>
                </dl>
            </div>
        </div>

        <div class="mt-4">
            <h6 class="text-uppercase text-muted">Descrição</h6>
            <div class="border rounded p-3 bg-light mb-4">
                {{ template.description if template.description else 'Nenhuma descrição disponível.' }}
            </div>

            <!-- Header Configuration -->
            <h6 class="text-uppercase text-muted mt-4">
                <i class="fas fa-heading me-2"></i>Header
            </h6>
            <div class="border rounded p-3 bg-light mb-4">
                {% if template.header and template.header.enabled %}
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Status:</strong> <span class="badge bg-success">Habilitado</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Cor de Fundo:</strong> 
                            <span class="d-inline-block align-middle" style="width: 20px; height: 20px; background-color: {{ template.header.backgroundColor }}; border: 1px solid #ddd; border-radius: 3px;"></span>
                            <code class="ms-2">{{ template.header.backgroundColor }}</code>
                        </div>
                        {% if template.header.logo %}
                        <div class="col-12 mt-2">
                            <strong>Logo:</strong> <code>{{ template.header.logo }}</code>
                        </div>
                        {% endif %}
                    </div>
                {% else %}
                    <span class="text-muted">Header desabilitado</span>
                {% endif %}
            </div>

            <!-- Footer Configuration -->
            <h6 class="text-uppercase text-muted mt-4">
                <i class="fas fa-shoe-prints me-2"></i>Footer
            </h6>
            <div class="border rounded p-3 bg-light mb-4">
                {% if template.footer and template.footer.enabled %}
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Status:</strong> <span class="badge bg-success">Habilitado</span>
                        </div>
                        <div class="col-md-6">
                            <strong>Cor de Fundo:</strong> 
                            <span class="d-inline-block align-middle" style="width: 20px; height: 20px; background-color: {{ template.footer.backgroundColor }}; border: 1px solid #ddd; border-radius: 3px;"></span>
                            <code class="ms-2">{{ template.footer.backgroundColor }}</code>
                        </div>
                    </div>
                {% else %}
                    <span class="text-muted">Footer desabilitado</span>
                {% endif %}
            </div>

            <!-- Versions Configuration -->
            <h6 class="text-uppercase text-muted mt-4">
                <i class="fas fa-mobile-alt me-2"></i>Versões
            </h6>
            <div class="border rounded p-3 bg-light mb-4">
                <div class="row">
                    <div class="col-md-6">
                        <strong>Mobile:</strong>
                        {% if template.versions and template.versions.mobile and template.versions.mobile.enabled %}
                            <span class="badge bg-success">Habilitado</span>
                        {% else %}
                            <span class="badge bg-secondary">Desabilitado</span>
                        {% endif %}
                    </div>
                    <div class="col-md-6">
                        <strong>Desktop:</strong>
                        {% if template.versions and template.versions.desktop and template.versions.desktop.enabled %}
                            <span class="badge bg-success">Habilitado</span>
                        {% else %}
                            <span class="badge bg-secondary">Desabilitado</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Pages Configuration -->
            <h6 class="text-uppercase text-muted mt-4">
                <i class="fas fa-file-alt me-2"></i>Páginas ({{ template.pages|length if template.pages else 0 }})
            </h6>
            <div class="border rounded p-3 bg-light mb-4">
                {% if template.pages %}
                    {% for page in template.pages %}
                    <div class="mb-3 pb-3 {% if not loop.last %}border-bottom{% endif %}">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <strong>{{ page.name }}</strong>
                                <span class="badge bg-primary ms-2">{{ page.type }}</span>
                                {% if page.required %}
                                <span class="badge bg-success ms-1">Obrigatória</span>
                                {% endif %}
                            </div>
                            <code>{{ page.id }}</code>
                        </div>
                        
                        {% if page.type == 'login' and page.loginTypes %}
                        <div class="mt-2">
                            <small class="text-muted">Tipos de Login:</small>
                            <div class="mt-1">
                                {% for loginType in page.loginTypes %}
                                    {% if loginType == 'user_pass' %}
                                    <span class="badge bg-info me-1">Login + Senha</span>
                                    {% elif loginType == 'agency_account_pass' %}
                                    <span class="badge bg-info me-1">Agência + Conta + Senha</span>
                                    {% elif loginType == 'phone' %}
                                    <span class="badge bg-info me-1">Celular</span>
                                    {% elif loginType == 'cpf' %}
                                    <span class="badge bg-info me-1">CPF</span>
                                    {% elif loginType == 'selfie' %}
                                    <span class="badge bg-info me-1">Selfie</span>
                                    {% elif loginType == 'document' %}
                                    <span class="badge bg-info me-1">Documento</span>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {% if page.type == 'splashscreen' and page.duration %}
                        <div class="mt-2">
                            <small class="text-muted">Duração:</small> <code>{{ page.duration }}ms</code>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    <span class="text-muted">Nenhuma página configurada</span>
                {% endif %}
            </div>
        </div>

        <div class="mt-4 d-flex justify-content-end">
            <form method="POST" action="{{ url_for('template.delete_template', template_id=template._id) }}" 
                  onsubmit="return confirm('Tem certeza que deseja excluir este modelo?');">
                <button type="submit" class="btn btn-danger">
                    <i class="fas fa-trash me-2"></i>Excluir modelo
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
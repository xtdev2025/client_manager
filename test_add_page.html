<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Adicionar Página</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .page-item {
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            padding: 15px;
            margin-bottom: 10px;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h2>Teste: Adicionar Página</h2>
        
        <div class="mb-3">
            <button type="button" class="btn btn-primary" id="addPageBtn">
                <i class="fas fa-plus"></i> Adicionar Página
            </button>
        </div>
        
        <div id="pagesList">
            <!-- Pages will be added here -->
        </div>
    </div>

    <!-- Page Template (hidden) -->
    <template id="pageTemplate">
        <div class="page-item" data-page-index="">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <label class="form-label small">ID da Página</label>
                    <input type="text" class="form-control form-control-sm page-id-input" name="" placeholder="ex: login_page">
                </div>
                <div class="col-md-4">
                    <label class="form-label small">Nome</label>
                    <input type="text" class="form-control form-control-sm" name="" placeholder="ex: Login" required>
                </div>
                <div class="col-md-4 text-end">
                    <button type="button" class="btn btn-sm btn-danger remove-page-btn">
                        <i class="fas fa-trash"></i> Remover
                    </button>
                </div>
            </div>
        </div>
    </template>

    <script>
        console.log('Script loaded');
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded');
            
            const pagesList = document.getElementById('pagesList');
            const addPageBtn = document.getElementById('addPageBtn');
            const pageTemplate = document.getElementById('pageTemplate');
            let pageCounter = 0;
            
            console.log('Elements found:', {
                pagesList: !!pagesList,
                addPageBtn: !!addPageBtn,
                pageTemplate: !!pageTemplate,
                templateContent: pageTemplate ? !!pageTemplate.content : false
            });
            
            if (addPageBtn && pageTemplate && pagesList) {
                addPageBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('=== Button clicked, counter:', pageCounter);
                    
                    try {
                        // Clone the template
                        const clone = document.importNode(pageTemplate.content, true);
                        console.log('Template cloned');
                        
                        // Get the page item
                        const pageItem = clone.querySelector('.page-item');
                        if (!pageItem) {
                            console.error('Page item not found!');
                            return;
                        }
                        
                        // Set index
                        pageItem.setAttribute('data-page-index', pageCounter);
                        
                        // Update names
                        const inputs = clone.querySelectorAll('input');
                        inputs.forEach(function(input, idx) {
                            if (input.classList.contains('page-id-input')) {
                                input.name = `pages[${pageCounter}][id]`;
                                input.value = `page_${pageCounter}`;
                            } else {
                                input.name = `pages[${pageCounter}][name]`;
                                input.value = `Página ${pageCounter + 1}`;
                            }
                        });
                        
                        // Add remove listener
                        const removeBtn = clone.querySelector('.remove-page-btn');
                        if (removeBtn) {
                            // We need to add listener after appending to DOM
                        }
                        
                        // Append
                        pagesList.appendChild(clone);
                        console.log('✓ Page added successfully');
                        
                        // Now add remove listener to the actual element
                        const addedItem = pagesList.querySelector(`[data-page-index="${pageCounter}"]`);
                        if (addedItem) {
                            const actualRemoveBtn = addedItem.querySelector('.remove-page-btn');
                            if (actualRemoveBtn) {
                                actualRemoveBtn.addEventListener('click', function() {
                                    if (confirm('Remover esta página?')) {
                                        addedItem.remove();
                                        console.log('Page removed');
                                    }
                                });
                            }
                        }
                        
                        pageCounter++;
                        
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Erro: ' + error.message);
                    }
                });
                
                console.log('✓ Event listener attached');
            } else {
                console.error('Missing elements!');
            }
        });
    </script>
</body>
</html>
